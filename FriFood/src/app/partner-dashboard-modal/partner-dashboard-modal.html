<div
  class="modal fade"
  [id]="'partnerDashboardModal-' + initiatingComponent"
  tabindex="-1"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">Partner Dashboard</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Partner info ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        @if (partner) {
        <section class="mb-4">
          <strong>{{ partner.name }}</strong>
          <div class="text-muted">{{ partner.address }}</div>
        </section>
        }

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Add offer button (OWNER ONLY) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        @if (isOwnerPartner) {
        <div class="mb-3">
          <button
            class="btn btn-sm btn-primary"
            (click)="startAddOffer()"
            [disabled]="editingOfferId !== null"
          >
            + Dodaj ponudbo
          </button>
        </div>
        }

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ New offer form ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        @if (editingOfferId === 'new') {
        <div class="border rounded p-3 mb-4 bg-light">
          <h6>Nova ponudba</h6>

          <input class="form-control mb-2" placeholder="Title" [(ngModel)]="draftOffer.title" />

          <textarea
            class="form-control mb-2"
            placeholder="Description"
            [(ngModel)]="draftOffer.description"
          ></textarea>

          <div class="row g-2 mb-2">
            <div class="col">
              <label class="small text-muted">Originala cena (‚Ç¨)</label>
              <input
                type="number"
                class="form-control"
                placeholder="Original price (‚Ç¨)"
                [(ngModel)]="draftOffer.price_original"
              />
            </div>
            <div class="col">
              <label class="small text-muted">Zni≈æana cena (‚Ç¨)</label>
              <input
                type="number"
                class="form-control"
                placeholder="Discounted price (‚Ç¨)"
                [(ngModel)]="draftOffer.price_discounted"
              />
            </div>
          </div>

          <div class="row g-2 mb-3">
            <div class="col">
              <label class="small text-muted">Rok poteka:</label>
              <input type="date" class="form-control" [(ngModel)]="draftOffer.expiry_date" />
            </div>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-success btn-sm" (click)="saveOffer()">Shrani</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Prekliƒçi</button>
          </div>
        </div>
        }

        <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Offers list ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        @for (offer of offers; track offer.id) {

        <div class="border rounded p-3 mb-3">
          <!-- EDIT MODE -->
          @if (editingOfferId === offer.id) {

          <h6>Edit Offer</h6>

          <input class="form-control mb-2" [(ngModel)]="draftOffer.title" />

          <textarea class="form-control mb-2" [(ngModel)]="draftOffer.description"></textarea>

          <div class="row g-2 mb-2">
            <div class="col">
              <input type="number" class="form-control" [(ngModel)]="draftOffer.price_original" />
            </div>
            <div class="col">
              <input type="number" class="form-control" [(ngModel)]="draftOffer.price_discounted" />
            </div>
          </div>

          <div class="row g-2 mb-3">
            <div class="col">
              <input type="date" class="form-control" [(ngModel)]="draftOffer.expiry_date" />
            </div>
          </div>

          <div class="d-flex gap-2">
            <button class="btn btn-success btn-sm" (click)="saveOffer()">Shrani</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Prekliƒçi</button>
          </div>

          }
          <!-- READ MODE -->
          @else {

          <strong>{{ offer.title }}</strong>

          @if (offer.description) {
          <div class="text-muted small">
            {{ offer.description }}
          </div>
          }

          <div class="small mt-1">
            <strong>‚Ç¨{{ offer.price_discounted }}</strong>
            <span class="text-muted ms-2">
              <s>‚Ç¨{{ offer.price_original }}</s>
            </span>
            @if (offer.price_original > 0) {
            <span class="text-success ms-2"> -{{ discountPercent(offer) }}% </span>
            }
          </div>

          <div class="small text-muted">
            Rok poteka:
            {{ offer.expiry_date | date : 'longDate' }}
          </div>

          <!-- OWNER ACTIONS -->
          @if (isOwnerPartner) {
          <div class="d-flex gap-2 mt-2">
            <button class="btn btn-outline-secondary btn-sm" (click)="startEditOffer(offer)">
              ‚úèÔ∏è Uredi
            </button>
            <button class="btn btn-outline-danger btn-sm" (click)="deleteOffer(offer.id)">
              üóë Izbri≈°i
            </button>
          </div>
          } }
        </div>
        } @if (!offers.length) {
        <div class="text-muted fst-italic">Ponudb ni na voljo.</div>
        }
      </div>
    </div>
  </div>
</div>
